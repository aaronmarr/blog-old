<!doctype html>
<html lang="en" class="text-base sm:text-base md:text-lg lg:text-xl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementing UUIDs in Laravel</title>
    <meta name="Description" content="Implementing UUIDs in Laravel models using PHP Traits">
    <link type="text/css" rel="stylesheet" href="/build/index.css?v=21">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Aaron Marr">
  </head>
  <body class="font-serif">
    
    <header class="[ site-header ] [ ]">
      <div class="p-4 max-w-xl m-auto">
        <a href="#content" class="visually-hidden">Skip to main content</a>
        <div class="">
          <div class="lg:flex items-center justify-between flex-wrap bg-teal">
            <div class="flex items-center flex-no-shrink text-white mr-6">
              <a href="/" class="font-sans font-normal text-base tracking-tight">Aaron Marr</a>
            </div>
            <nav class="text-sm ml-auto overflow-x-auto flex font-sans">
              <a 
                href="/posts"
                class="py-2 flex-shrink-0 hover:no-underline ml-0 lg:ml-0 underline"
              >
                Blog
              </a>
              <a 
                href="/assets/aaronmarr_cv.pdf"
                class="py-2 flex-shrink-0 hover:no-underline ml-2 lg:ml-4 underline"
              >
                Download CV
              </a>
              <a 
                href="mailto:hello@aaronmarr.co.uk" 
                class="py-2 flex-shrink-0 hover:no-underline ml-2 lg:ml-4 underline"
              >
                Email Me
              </a>
              <a 
                href="https://twitter.com/_aaronmarr" 
                class="py-2 flex-shrink-0 hover:no-underline ml-2 lg:ml-4 underline"
              >
                Twitter
              </a>
              <a 
                href="https://linkedin.com/in/aaron-marr" 
                class="py-2 flex-shrink-0 hover:no-underline ml-2 lg:ml-4 underline"
              >
                LinkedIn
              </a>
            </nav>
          </div>
        </div>
      </div>
    </header>
    <main id="content">
      <article>
  <header class="pt-8 pb-4">
    <div class="[ banner ] [ py-2 px-4 max-w-xl m-auto ]">
      <h2 class="[ banner__headline ] [ font-bold font-serif leading-tight text-2xl sm:text-2xl md:text-3xl tracking-tight mt-0 mb-2 ]">Implementing UUIDs in Laravel</h2>
      <time class="[ banner__strapline ] [ font-sans text-sm ]" datetime="2019-09-15">15th September 2019</time>
    </div>
  </header>
  <div class="[ typeset template-post ] [ px-4 max-w-xl m-auto ]">
    <p>In a previous post, I looked at using Laravel's authentication scaffolding. While this provides a lot out-of-the box, you may want to use <code>uuids</code> for primary keys in the <code>User</code> model, instead of <code>bigIncrements</code>.</p>
<blockquote>
<p><code>Uuid</code> fields are more secure than <code>bigIncrements</code> because they're much, <em>much</em> harder to guess than incrementing integer values.</p>
</blockquote>
<p>In this post, I'll look at implementing <code>uuid</code> fields for Eloquent models. I'll also look at sharing this functionality between multiple models using PHP Traits.</p>
<p>To start, modify the <code>create_users</code> migration, updating the <code>id</code> field type to become <code>uuid</code>.</p>
<pre class="language-php"><code class="language-php"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">    Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'email_verified_at'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">rememberToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Next, we'll override <code>boot</code>, and hook into Eloquent's <code>creating</code> lifecycle method in the <code>User</code> model. We'll return a <code>uuid</code> for the primary key when creating new <code>User</code> records.</p>
<pre class="language-php"><code class="language-php"><span class="highlight-line"><span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">creating</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getKeyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>We'll also disable incrementing <code>ids</code> and specify a key type of <code>string</code> (instead of <code>bigInteger</code>):</p>
<pre class="language-php"><code class="language-php"><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getIncrementing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getKeyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">return</span> <span class="token single-quoted-string string">'string'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>With our migration and model updated, go ahead and run the migrations:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">php artisan migrate</span></code></pre>
<p>At this point, authentication should be working and you'll be able to create a new user via the UI. Go ahead and create a new user account now.</p>
<p>Once you've registered a new user, take a look at the <code>id</code> field in Tinker. This should now be set to a <code>uuid</code> string, instead of the default <code>bigIncrements</code> value:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">php artisan tinker</span><br><span class="highlight-line"></span><br><span class="highlight-line">App<span class="token punctuation">\</span>User::all<span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token operator">=</span><span class="token operator">></span> Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Collection <span class="token punctuation">{</span>#3027</span><br><span class="highlight-line">     all: <span class="token punctuation">[</span></span><br><span class="highlight-line">       App<span class="token punctuation">\</span>User <span class="token punctuation">{</span>#3028</span><br><span class="highlight-line">         id: <span class="token string">"183273bc-cf61-45ff-8e56-13b7253411c2"</span>,</span><br><span class="highlight-line">         name: <span class="token string">"Aaron Example"</span>,</span><br><span class="highlight-line">         email: <span class="token string">"aaron@example.com"</span>,</span><br><span class="highlight-line">         email_verified_at: null,</span><br><span class="highlight-line">         created_at: <span class="token string">"2019-09-21 08:56:13"</span>,</span><br><span class="highlight-line">         updated_at: <span class="token string">"2019-09-21 08:56:13"</span>,</span><br><span class="highlight-line">       <span class="token punctuation">}</span>,</span><br><span class="highlight-line">     <span class="token punctuation">]</span>,</span><br><span class="highlight-line">   <span class="token punctuation">}</span></span></code></pre>
<p>While this approach is fine in a simple application with only a couple of models, you may find yourself wanting to share this functionality between more models, and it could become an overhead. This is a good use case for PHP Traits, which allow you to easily share code between independent classes. Let's take a look:</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Traits</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">trait</span> HasUuid</span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">bootHasUuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">creating</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$model</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">                <span class="token variable">$model</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token variable">$model</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getKeyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">            <span class="token punctuation">}</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getIncrementing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token boolean constant">false</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getKeyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token keyword">return</span> <span class="token single-quoted-string string">'string'</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>As you can see, we've moved the <code>boot</code> method override, <code>getIncrementing</code> and <code>getKeyType</code> methods into the Trait. The boot method override is also renamed to <code>bootHasUuid</code>. This is an example of implementing Laravel's bootable Traits, which enable us to override Eloquent's boot method in any models which inherit the Trait. Nice.</p>
<p>In the User model we can remove the boot method override, <code>getIncrementing</code> and <code>getKeyType</code> methods and implement the Trait for our model using <code>use Traits\HasUuid;</code> in the class:</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>MustVerifyEmail</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notifiable</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span></span><br><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token keyword">use</span> <span class="token package">Notifiable</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token keyword">use</span> <span class="token package">Traits<span class="token punctuation">\</span>HasUuid</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Let's migrate our database again and double check once more that the <code>uuid</code> is still being set.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">php artisan migrate:fresh</span></code></pre>
<p>Be sure to create a new account, then check the database again:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token operator">>></span><span class="token operator">></span> App<span class="token punctuation">\</span>User::all<span class="token punctuation">(</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token operator">=</span><span class="token operator">></span> Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Collection <span class="token punctuation">{</span>#3029</span><br><span class="highlight-line">     all: <span class="token punctuation">[</span></span><br><span class="highlight-line">       App<span class="token punctuation">\</span>User <span class="token punctuation">{</span>#3030</span><br><span class="highlight-line">         id: <span class="token string">"a7fbf694-8356-4ace-9b0b-525b35e71ed7"</span>,</span><br><span class="highlight-line">         name: <span class="token string">"Aaron Example"</span>,</span><br><span class="highlight-line">         email: <span class="token string">"aaron@example.com"</span>,</span><br><span class="highlight-line">         email_verified_at: null,</span><br><span class="highlight-line">         created_at: <span class="token string">"2019-09-20 20:53:43"</span>,</span><br><span class="highlight-line">         updated_at: <span class="token string">"2019-09-20 20:53:43"</span>,</span><br><span class="highlight-line">       <span class="token punctuation">}</span>,</span><br><span class="highlight-line">     <span class="token punctuation">]</span>,</span><br><span class="highlight-line">   <span class="token punctuation">}</span></span></code></pre>
<p>Awesome! The <code>uuid</code> is set, but this time the implementation uses Traits, meaning we can share this functionality with other models, as and when required.</p>
<p>I hope you've found this post useful. I can certainly see myself using this pattern when developing applications in the future. Thanks for reading.</p>

  </div>
</article>



    </main>
    <footer class="border-t block pt-4 pb-8 mt-16">
      <div class="max-w-xl m-auto px-4 flex items-baseline">
        <p class="font-sans text-xs">&copy Aaron Marr 2020.</p>
        <a href="#" class="[ site-header__button ] [ ml-auto p-2 border border-solid font-sans text-sm ]" onclick="localStorage.setItem('mode', (localStorage.getItem('mode') || 'dark') === 'dark' ? 'light' : 'dark'); localStorage.getItem('mode') === 'dark' ? document.querySelector('body').classList.add('dark') : document.querySelector('body').classList.remove('dark')" title="Dark/light">
          <span class="hidden-when-dark">Dark mode</span>
          <span class="hidden shown-when-dark">Light mode</span>
        </a>
      </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function(event) {
        event.preventDefault();
        ((localStorage.getItem('mode') || 'dark') === 'dark') ?
          document.querySelector('body').classList.add('dark') :
          document.querySelector('body').classList.remove('dark');
      })
    </script>
  </body>
</html>
