<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploying 11ty to Github Pages using Travis</title>
    <meta name="Description" content="Taking a look at deploying an 11ty site to Github Pages Travis">
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css">
    <link type="text/css" rel="stylesheet" href="/build/index.css">
    <link rel="stylesheet" href="/build/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Aaron Marr">
    <!-- <link rel="stylesheet" href="//basehold.it/10">     -->
  </head>
  <body class="line-numbers">
    <header class="header">
      <div class="header__content">
        <h1 class="site-name">
          <a class="site-name__link" href="/">
            Aaron Marr
          </a>
        </h1>
        <nav class="nav">
          <ul class="nav__list"><li class="nav__item">
              <a class="nav__link" href="/feed/feed.xml">
                RSS
              </a>
            </li><li class="nav__item">
              <a class="nav__link" href="/posts/">
                Blog
              </a>
            </li></ul>
        </nav>
      </div>
    </header>

    <main class="main typeset template-post">
      <h1>Deploying 11ty to Github Pages using Travis</h1>

<p>Eleventy is a brilliant static site generator built on JavaScript. I've always been a huge fan of Jekyll, but 11ty does provide some enhancements over Jekyll in terms of greater flexibility and a more vibrant community behind it.</p>
<p>One of the benefits of Jekyll is that it has first-class integration with Github Pages. You simply push to a <code>gh-pages</code> branch, and Github looks after building and deploying your site to a live URL for you. With 11ty, you are responsible for building and deploying. In this post, I'll look at deploying 11ty to Github Pages using Travis CI.</p>
<h2 id="create-a-repository-on-github">Create a repository on Github <a class="direct-link" href="#create-a-repository-on-github" aria-hidden="true">#</a></h2>
<p>The first thing you will need is an Eleventy installation pushed to a repository on Github. I used the <a href="https://github.com/11ty/eleventy-base-blog">Eleventy base blog</a> &quot;starter&quot; template for my site. This contains a base installation of 11ty, set up with a couple of static pages to get you going. I also created a repo on Github with the name &quot;blog&quot; and pushed my local 11ty site to the <code>master</code> branch.</p>
<aside>Github does provide a way for you to auto-publish from a master branch at [username].github.io, but this does remove some of the flexibility of build and deploy branches. I want total control over which branches are built and deployed, so I chose "blog" for my repository name, instead of opting for the standard [username].github.io one.</aside>
<p>There are a few settings in Github which I also adjusted. In the repository settings, there's a section for Github Pages. In here, I selected &quot;enable pages&quot; and also set up my custom domain name. If you're using a custom domain, you'll need to point your DNS to the Github Pages IPs, and also create a CNAME file in the base of your repository. More details about that can be found in the <a href="https://help.github.com/en/articles/using-a-custom-domain-with-github-pages">Github documentation</a>.</p>
<p><img src="../../img/gh-pages-setup.png" alt="alt text" title="Github Pages settings screenshot"></p>
<p>One final step you will need to do is create a Github authentication key, which will be used by Travis to authenticate. In the developer menu, set up a new key, and copy to your clipboard. You will use this key once Travis has been set up.</p>
<h2 id="set-up-travis">Set up Travis <a class="direct-link" href="#set-up-travis" aria-hidden="true">#</a></h2>
<p>At this point, I signed up for Travis. On signing up, you should follow the on-screen instructions to integrate Travis with your Github account. There will be several steps and you will be asked to grant permissions to Travis so that it can access any repositories you want to build and deploy.</p>
<p>Once the setup process is complete, you should see your 11ty repository in Travis. In the settings, you should add a new authentication key and paste in the key from the previous step. You should call this key <code>$GITHUB_TOKEN</code> – if you look inside the <code>travis.yml</code> file in your repo, you'll see there's a property called <code>github-toke</code>n which matches this key. This is what Travis uses to authenticate with Github when building and deploying.</p>
<p><img src="../../img/travis-ci-env-vars.png" alt="alt text" title="Travis CI environment variables settings screenshot"></p>
<p>Whilst inside the <code>travis.yml</code> file, there are a few other settings which should be updated. I set the path prefix to &quot;/&quot;. I want to deploy my site without a prefix – i.e. <a href="https://aaronmarr.co.uk">https://aaronmarr.co.uk</a> – and I also added my custom domain under the <code>fqdn</code> setting.  I also set up my build and deploy branches. These are set to <code>master</code> and <code>gh-pages</code>, respectively. Here's what my finalised <code>travis.yml</code> file looks like.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="highlight-line">language<span class="token punctuation">:</span> node_js</span><br><span class="highlight-line">node_js<span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token operator">-</span> <span class="token number">8</span></span><br><span class="highlight-line">before_script<span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token operator">-</span> npm install @<span class="token number">11</span>ty<span class="token operator">/</span>eleventy <span class="token operator">-</span>g</span><br><span class="highlight-line">script<span class="token punctuation">:</span> eleventy <span class="token operator">--</span>pathprefix<span class="token operator">=</span><span class="token string">"/"</span></span><br><span class="highlight-line">deploy<span class="token punctuation">:</span></span><br><span class="highlight-line">  fqdn<span class="token punctuation">:</span> aaronmarr<span class="token punctuation">.</span>co<span class="token punctuation">.</span>uk</span><br><span class="highlight-line">  local<span class="token operator">-</span>dir<span class="token punctuation">:</span> _site</span><br><span class="highlight-line">  provider<span class="token punctuation">:</span> pages</span><br><span class="highlight-line">  skip<span class="token operator">-</span>cleanup<span class="token punctuation">:</span> <span class="token keyword">true</span></span><br><span class="highlight-line">  github<span class="token operator">-</span>token<span class="token punctuation">:</span> <span class="token variable">$GITHUB_TOKEN</span>  <span class="token comment"># Set in travis-ci.org dashboard, marked secure</span></span><br><span class="highlight-line">  keep<span class="token operator">-</span>history<span class="token punctuation">:</span> <span class="token keyword">true</span></span><br><span class="highlight-line">  target_branch<span class="token punctuation">:</span> gh<span class="token operator">-</span>pages</span><br><span class="highlight-line">  on<span class="token punctuation">:</span></span><br><span class="highlight-line">    branch<span class="token punctuation">:</span> master</span></code></pre>
<p>At this point, you should be able to build and deploy to Github. In Travis, select &quot;Build Now&quot; and wait a minute or two for Travis to do its thing. Once Travis has finished building, you'll see a success message in the console indicating that your site is deployed.</p>
<p><img src="../../img/travis-ci-build-ok.png" alt="alt text" title="Travis CI build success screenshot"></p>
<p>One thing to bear in mind is Travis will conveniently deploy whatever you push to your <code>master</code> branch. For development, I set up a <code>develop</code> branch on Github, so that I only push/merge to <code>master</code> when I want to trigger a deployment.</p>
<p>Congratulations! You've successfully deployed your 11ty site using Travis CI. If you head back over to Github, you should see that Travis has created a new branch, <code>gh-pages</code>, with the built 11ty site inside. You should be able to see your site live, so open it in your browser, and bask in the glory! I hope you've found this post useful, please get in touch if you have any questions or comments.</p>


<p><a href="/">← Home</a></p>

    </main>

    <footer class="footer">
      <div class="footer__content">
        <p>&copy Aaron Marr 2019</p>
      </div>
    </footer>

    <!-- Current page: /posts/eleventy-travis-ci/ -->
  </body>
</html>
