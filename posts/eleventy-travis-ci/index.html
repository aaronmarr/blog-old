<!doctype html>
<html lang="en" class="text-base sm:text-base md:text-lg lg:text-xl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statically Deploy Eleventy to Github Pages using Travis</title>
    <meta name="Description" content="Taking a look at deploying an Eleventy static site to Github Pages using Travis CI">
    <link type="text/css" rel="stylesheet" href="/build/index.css?v=16">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Aaron Marr">
  </head>
  <body class="font-sans px-4">
    
    <header class="[ site-header ] [ my-4 ]">
      <a href="#content" class="visually-hidden">Skip to main content</a>
      <div class="ml-auto mr-auto">
        <div class="flex">
          <h1>
            <a 
              class="[ site-header__link ] [ font-sans font-normal text-sm ]" 
              href="/"
            >
              Aaron Marr
            </a>
          </h1>
          <nav class="pl-4 flex-auto text-right">
            <ul class="inline-block w-full"><li class="ml-3 inline ">
                <a class="[ site-header__link ] [ font-sans text-sm ]" href="/posts/">
                  Blog
                </a>
              </li><li class="ml-3 inline">
                <a href="#" class="[ site-header__button ] [ p-2 border border-solid font-sans text-sm ]" onclick="localStorage.setItem('mode', (localStorage.getItem('mode') || 'dark') === 'dark' ? 'light' : 'dark'); localStorage.getItem('mode') === 'dark' ? document.querySelector('body').classList.add('dark') : document.querySelector('body').classList.remove('dark')" title="Dark/light">
                  <span class="hidden-when-dark">Dark mode</span>
                  <span class="hidden shown-when-dark">Light mode</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </header>
      <main id="content">
        <article>
  <div class="border-t py-8">
    <div class="[ banner ] [ py-2 max-w-lg ml-auto mr-auto ]">
      <h2 class="[ banner__headline ] [ font-bold font-serif leading-tight text-2xl md:text-3xl tracking-tight mt-0 mb-2 ]">Statically Deploy Eleventy to Github Pages using Travis</h2>
      <time class="[ banner__strapline ] [ font-sans text-sm ]" datetime="2019-07-25">25 Jul 2019</time>
    </div>
  </div>
  <div class="[ typeset template-post ] [ max-w-lg ml-auto mr-auto ]">
  <p>In this post I'll look at deploying a static website built using <a href="https://www.11ty.io/">Eleventy</a> to <a href="https://pages.github.com/">Github Pages</a> using <a href="https://travis-ci.com/">Travis CI</a>.</p>
<h3 id="set-up-eleventy">Set up Eleventy <a class="hidden" href="#set-up-eleventy" aria-hidden="true">#</a></h3>
<p>The first thing you will need is an Eleventy site running on your local machine. There are some brilliant <a href="https://www.11ty.io/docs/starter/">starter projects</a> provided by the community. In this post, I'll use <a href="https://github.com/11ty/eleventy-base-blog">Eleventy base blog</a> as a starting point. Clone the repository and then change into the directory:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">git</span> clone https://github.com/11ty/eleventy-base-blog.git my-blog-name</span><br><span class="highlight-line"><span class="token builtin class-name">cd</span> my-blog-name</span></code></pre>
<p>Inside the project directory, <code>npm install</code> dependencies and then run <code>eleventy</code> – this will compile the starter project locally into a new <code>_site</code> directory. The <code>_site</code> folder contains the static markup and assets which we'll deploy to Github Pages using Travis:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">npm</span> <span class="token function">install</span></span><br><span class="highlight-line">npx eleventy</span></code></pre>
<p>You should see output like the following, indicating the compilation was successful:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token punctuation">..</span>.</span><br><span class="highlight-line">Writing _site/about/index.html from ./about/index.md.</span><br><span class="highlight-line">Writing _site/tags/another-tag/index.html from ./tags.njk.</span><br><span class="highlight-line">Writing _site/tags/number-2/index.html from ./tags.njk.</span><br><span class="highlight-line">Copied <span class="token number">2</span> items and Processed <span class="token number">16</span> files <span class="token keyword">in</span> <span class="token number">0.34</span> seconds <span class="token punctuation">(</span><span class="token number">21</span>.3ms each, v0.9.0<span class="token punctuation">)</span></span></code></pre>
<h3 id="set-up-git">Set up Git <a class="hidden" href="#set-up-git" aria-hidden="true">#</a></h3>
<p>Next, we'll push the Eleventy code to Github. You'll need to create a new repository on github (e.g., in this example the repository name is <code>my-blog-name</code>).</p>
<p>Once the repository is set up on Github, create a new repository locally and then push the code.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token comment"># First, remove the existing Eleventy repo</span></span><br><span class="highlight-line"><span class="token function">rm</span> -rf .git</span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment"># Next, create a new repo and push to Github</span></span><br><span class="highlight-line"><span class="token function">git</span> init</span><br><span class="highlight-line"><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span></span><br><span class="highlight-line"><span class="token function">git</span> commit -m <span class="token string">"first commit"</span></span><br><span class="highlight-line"><span class="token function">git</span> remote <span class="token function">add</span> origin https://github.com/<span class="token punctuation">[</span>your <span class="token function">git</span> username<span class="token punctuation">]</span>/my-blog-name.git</span><br><span class="highlight-line"><span class="token function">git</span> push -u origin master</span></code></pre>
<p>Now we'll set up Github Pages. Create a new branch called <code>gh-pages</code> in Github, and enable Pages by going to Settings / Github Pages and selecting <code>gh-pages</code> as the source branch.</p>
<p>We'll also need to create a new access token so Travis can push your site to the <code>gh-pages</code> branch. In Settings / Developer Settings / Personal Access Tokens select &quot;Generate new token.&quot; When prompted, provide a note for this key (e.g., Travis key) and then grant access to your public repositories by checking <code>public_repo</code>.</p>
<p>Next, select &quot;Generate token.&quot; On the next page you will be able to see you new token. Copy / paste this to a safe place (you'll need this handy in the next step).</p>
<h3 id="set-up-travis">Set up Travis <a class="hidden" href="#set-up-travis" aria-hidden="true">#</a></h3>
<p>Now we'll set up Travis. If you don't have an account, sign up for one now on the <a href="https://travis-ci.com">Travis website</a>. Follow the on-screen instructions to integrate Travis with your Github account. There will be several steps and you will be asked to grant permissions to Travis so that it can access any repositories you want to build and deploy.</p>
<p>Once the setup process is complete, head back to Github and configure the <a href="https://github.com/apps/travis-ci">Github Travis app</a>. Scroll down to the Repositories section, and select your Eleventy repository (e.g., <code>my-blog-name</code>). Once this is complete, you'll be redirected back to Travis, where you'll see your repository listed under your account.</p>
<p>Next, in the repository settings in Travis, you should add a new authentication key. Paste in the GitHub key you created earlier, name it <code>$GITHUB_TOKEN</code>. This will then be populated by Travis when it reads the <code>travis.yml</code> file in your Git repository. If you take a look at that file you'll see a property named <code>github-token</code>, the value of which matches the variable name we just created in Travis.</p>
<p>Let's take a quick look at the <code>travis.yml</code> file now. I've set the path prefix to &quot;/&quot;. I also set the build and deploy branches to <code>master</code> and <code>gh-pages</code>, respectively. Here's what my finalised <code>travis.yml</code> file looks like.</p>
<pre class="language-yaml"><code class="language-yaml"><span class="highlight-line"><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js</span><br><span class="highlight-line"><span class="token key atrule">node_js</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token punctuation">-</span> <span class="token number">8</span></span><br><span class="highlight-line"><span class="token key atrule">before_script</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token punctuation">-</span> npm install @11ty/eleventy <span class="token punctuation">-</span>g</span><br><span class="highlight-line"><span class="token key atrule">script</span><span class="token punctuation">:</span> eleventy <span class="token punctuation">-</span><span class="token punctuation">-</span>pathprefix="/"</span><br><span class="highlight-line"><span class="token key atrule">deploy</span><span class="token punctuation">:</span></span><br><span class="highlight-line">  <span class="token key atrule">local-dir</span><span class="token punctuation">:</span> _site</span><br><span class="highlight-line">  <span class="token key atrule">provider</span><span class="token punctuation">:</span> pages</span><br><span class="highlight-line">  <span class="token key atrule">skip-cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span><br><span class="highlight-line">  <span class="token comment"># Set in travis-ci.org dashboard</span></span><br><span class="highlight-line">  <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $GITHUB_TOKEN  </span><br><span class="highlight-line">  <span class="token key atrule">keep-history</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span><br><span class="highlight-line">  <span class="token comment"># Deploy branch</span></span><br><span class="highlight-line">  <span class="token key atrule">target_branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages</span><br><span class="highlight-line">  <span class="token key atrule">on</span><span class="token punctuation">:</span></span><br><span class="highlight-line">    <span class="token comment"># Build branch</span></span><br><span class="highlight-line">    <span class="token key atrule">branch</span><span class="token punctuation">:</span> master</span></code></pre>
<p>Now you can build and deploy. In Travis, select &quot;Build Now&quot;, waiting a moment for Travis to build and deploy. On Completion, you'll notice a success message in the console indicating that your site has been deployed.</p>
<p>One thing to bear in mind is Travis will conveniently deploy whatever you push to your <code>master</code> branch. For development, I set up a <code>develop</code> branch on Github, so that I only push/merge to <code>master</code> when I want to trigger a deployment.</p>
<p>If you head back over to Github, you should see that Travis has populated the <code>gh-pages</code> branch with the built site. You should also now be able to see your site live at <code>https://[your user name].github.com/my-blog-name</code>.</p>
<p>I hope you've found this post useful. Please get in touch if you have any questions or comments. Thanks for reading.</p>

  </div>
</article>



      </main>
    <footer class="py-8 mt-8 max-w-lg ml-auto mr-auto">
      <p class="text-sm font-sans">&copy; Aaron Marr 2019.</p>
    </footer>
    <script>
      document.addEventListener('DOMContentLoaded', function(event) {
        ((localStorage.getItem('mode') || 'dark') === 'dark') ? 
          document.querySelector('body').classList.add('dark') : 
          document.querySelector('body').classList.remove('dark');
      })
    </script>
  </body>
</html>
